<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badwin Loans</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
body {
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
    margin: 0;
    padding: 0;
}

.navbar {
    width: 100%;
    background-color: #343a40; /* Dark background color */
    display: flex;
    justify-content: center; /* Center navbar horizontally */
    padding: 15px 0; /* Padding for vertical spacing */
    margin-bottom: 40px; /* Space below the navbar */
}

.container {
    display: flex;
    justify-content: center; /* Center content horizontally in the container */
    width: 100%;
}

.navbar-nav {
    display: flex;
    justify-content: center; /* Center items horizontally */
    align-items: center; /* Center items vertically */
    margin: 0;
    padding: 0;
    list-style: none;
}

.navbar-nav .nav-item {
    margin: 0 12px; /* Horizontal spacing between items */
}

.nav-link {
    color: #fff; /* White text color */
    padding: 10px 15px; /* Padding for better spacing */
    text-decoration: none; /* Remove underline from links */
    font-size: 16px; /* Adjust font size */
    border-radius: 4px; /* Rounded corners for the links */
    transition: background-color 0.3s, color 0.3s; /* Smooth transition for hover effect */
}

.nav-link:hover {
    background-color: #495057; /* Darker background on hover */
    color: #adb5bd; /* Lighter text color on hover */
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .navbar-nav {
        flex-direction: row; /* Align items horizontally on small screens */
        flex-wrap: wrap; /* Allow wrapping if necessary */
        justify-content: center; /* Center items horizontally */
    }

    .nav-item {
        margin: 8px; /* Vertical and horizontal spacing between items */
    }
}

    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
<style>
/* Center the navbar container */
.navbar-nav {
  display: flex;
  justify-content: center; /* Center items horizontally */
  list-style: none; /* Remove default bullet points */
  padding: 0;
  margin: 0;
  background-color: #f8f9fa; /* Light background for the navbar */
  border-radius: 10px; /* Smooth rounded edges */
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow */
  overflow: hidden; /* Ensure content stays within bounds */
}

/* Center the navbar container itself */
.navbar {
  display: flex;
  justify-content: center; /* Center navbar container horizontally */
  width: 100%; /* Ensure it spans the full width */
  padding: 10px 0; /* Add padding for spacing */
}

/* Other styles remain unchanged */
.navbar-nav .nav-item {
  margin: 0 15px; /* Add horizontal spacing between items */
}

.navbar-nav .nav-link {
  text-decoration: none; /* Remove underline from links */
  padding: 10px 15px; /* Add spacing inside the link */
  font-size: 1rem; /* Adjust font size */
  color: #007bff; /* Bootstrap primary color for links */
  transition: all 0.3s ease; /* Smooth hover effect */
  border-radius: 5px; /* Rounded corners for links */
}

.navbar-nav .nav-link:hover {
  background-color: #e9ecef; /* Light gray hover effect */
  color: #0056b3; /* Darker blue text on hover */
}

.navbar-nav .nav-item .nav-link.active {
  background-color: #007bff; /* Active link background */
  color: #fff; /* White text for active link */
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .navbar-nav {
    flex-direction: row; /* Keep items horizontally aligned on smaller screens */
    text-align: center; /* Center text alignment */
    flex-wrap: wrap; /* Allow wrapping if items don't fit */
  }

  .navbar-nav .nav-item {
    margin: 5px 10px; /* Adjust horizontal spacing between items */
  }
}
</style>

<!-- Beautified and Centered Navigation Bar -->
<div class="navbar">
  <ul class="navbar-nav">

    
        <li class="nav-item">
          <a class="nav-link" href="{% url 'branch_list' %}">Branches</a>
        </li>
    
        <li class="nav-item">
          <a class="nav-link" href="{% url 'add_branch' %}">add_branch</a>
        </li>
    
    
      <li class="nav-item">
        <a class="nav-link" href="{% url 'view_transactions' %}">Transactions</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'logout' %}">Logout</a>
      </li>

      
      {% if user.is_authenticated %}
      {% if request.user.is_staff %}
        <li class="nav-item">
          <a class="nav-link" href="http://127.0.0.1:8000/admin/">Staff</a>
        </li>

      {% endif %}
    {% endif %}
  </ul>
</div>


        </div>
    </nav>
<style>
    html, body {
        height: 100%;
        margin: 0;
    }

    /*.full-screen-container {*/
    /*    display: flex;*/
        justify-content: center; /* Horizontally center the container */
        align-items: center; /* Vertically center the container */
        height: 100vh; /* Full height of the viewport */
    /*}*/

    .containerr {
        max-width: 1000px; /* Maximum width of the container */
        width: 90%; /* Take up 90% of the viewport width */
        padding: 30px;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        background-color: #f9f9f9;
    }
</style>


<div class="full-screen-container">
    <div class="containerr">
            {% block content %}

            {% endblock %}
        </div>
    </div>

    <!-- JavaScript for Popup and Loan Actions -->
    <script>
        $(document).ready(function() {
            // Function to check loan status and update the UI
            function checkLoanStatus(loanId) {
                var checkStatusUrl = '/payments/check_loan_status/' + loanId + '/';
                $.ajax({
                    url: checkStatusUrl,
                    type: 'GET',
                    success: function(response) {
                        var status = response.status;
                        var balance = response.balance;

                        var loanCard = $('#loan-card-' + loanId);
                        loanCard.find('.status').text('Status: ' + status);
                        loanCard.find('.balance').text('Balance: ' + balance.toFixed(2));

                        // Disable repay button if loan is not approved or balance is zero
                        if (status != 'approved' || balance <= 0) {
                            loanCard.find('.repay-button').prop('disabled', true);
                        } else {
                            loanCard.find('.repay-button').prop('disabled', false);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.log('Error occurred while checking loan status: ' + error);
                    }
                });
            }

            // Periodically check the status of each loan
            setInterval(function() {
                $('.card').each(function() {
                    var loanId = $(this).attr('id').replace('loan-card-', '');
                    checkLoanStatus(loanId);
                });
            }, 10000); // Check every 10 seconds

            // Repay Loan Button Click Event
            // $(document).on('click', '.repay-button', function() {
            //     var loanId = $(this).data('loan-id');
            //     var repayUrl = $(this).data('repay-url');
            //     var balance = parseFloat($('#loan-card-' + loanId + ' .balance').text().replace('Balance: ', '').trim());

            //     // Show popup with input field for amount
            //     var amountInput = prompt('Enter amount to repay:', balance.toFixed(2));
            //     var amount = parseFloat(amountInput);

            //     if (isNaN(amount) || amount <= 0 || amount > balance) {
            //         alert('Invalid amount. Please enter a valid amount.');
            //         return;
            //     }

                // Send AJAX request to repay_loan view
                $.ajax({
                    url: repayUrl,
                    type: 'POST',
                    data: {
                        amount: amount,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.success) {
                            $('#notification').fadeIn().delay(2000).fadeOut();

                            // Update the loan card UI
                            var loanCard = $('#loan-card-' + loanId);
                            var newBalance = balance - amount;
                            loanCard.find('.balance').text('Balance: ' + newBalance.toFixed(2));
                            var amountPaid = parseFloat(loanCard.find('.amount-paid').text()) + amount;
                            loanCard.find('.amount-paid').text(amountPaid.toFixed(2));

                            // Optionally, disable the repay button if balance is zero
                            if (newBalance <= 0) {
                                loanCard.find('.repay-button').prop('disabled', true);
                            }

                            // Optionally, update the payment dates list
                            loanCard.find('ul').append('<li>' + amount.toFixed(2) + ' - just now</li>');
                        } else {
                            alert('Failed to initiate loan repayment: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        alert('Error occurred during loan repayment: ' + error);
                    }
                });
            });

            // Apply Loan Button Click Event
            $(document).on('click', '.apply-button', function() {
                var loanId = $(this).data('loan-id');
                var applyUrl = $(this).data('apply-url');

                // Perform actions when Apply Loan button is clicked
                // For example, redirecting to the apply URL
                window.location.href = applyUrl;
            });
        });
    </script>
    {% block extra_scripts %}{% endblock %}

    {% for message in messages %}
    <div id="message-modal-{{ forloop.counter }}" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="message-modal-label-{{ forloop.counter }}" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header {% if message.tags == 'success' %}bg-success text-white{% elif message.tags == 'error' %}bg-danger text-white{% elif message.tags == 'warning' %}bg-warning text-dark{% else %}bg-info text-white{% endif %}">
            <h5 class="modal-title" id="message-modal-label-{{ forloop.counter }}">
              {% if message.tags %} {{ message.tags|title }} {% else %} Info {% endif %}
            </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="closeMessageModal({{ forloop.counter }})">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            {{ message }}
          </div>
          <!-- <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="closeMessageModal({{ forloop.counter }})">Close</button>
          </div> -->
        </div>
      </div>
    </div>
    {% endfor %}

    <script>
      function closeMessageModal(id) {
        var messageModal = document.getElementById("message-modal-" + id);
        if (messageModal) {
          $(messageModal).modal('hide');
          setTimeout(function() {
            messageModal.remove();
          }, 500); // Remove after the modal hide animation
        }
      }

      $(document).ready(function() {
        {% for message in messages %}
        $('#message-modal-{{ forloop.counter }}').modal('show');
        {% endfor %}
      });
    </script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>
